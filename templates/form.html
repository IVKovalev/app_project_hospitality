<!DOCTYPE html>
<html>
<head>
    <title>Форма</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192.png">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
    <meta name="theme-color" content="#1976d2">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
            background-color: #f5f5f5;
        }

        h2 {
            text-align: center;
        }

        form {
            max-width: 500px;
            margin: auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .button, select, input[type="submit"] {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            box-sizing: border-box;
        }

        .button, input[type="submit"] {
            background-color: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .button:hover, input[type="submit"]:hover {
            background-color: #125ca1;
        }

        .hidden {
            display: none;
        }
    </style>
    <script>
        const positionsOptions = ['Опция 1', 'Опция 2', 'Опция 3'];

		function updateFloor(select) {
			const button = document.getElementById('floorButton');
			button.textContent = 'Этаж ' + select.value;
			select.classList.add('hidden');
			showPositionFields();
		}

		function showPositionFields() {
			document.getElementById('positions').innerHTML = ''; 
			document.getElementById('serviceZonePositions').innerHTML = '';
			addPositionField('positions', 'position_pantry');
			addPositionField('serviceZonePositions', 'position_service');
			document.getElementById('addPositionBtn').style.display = 'block';
			document.getElementById('addServiceZonePositionBtn').style.display = 'block';
			document.getElementById('submitBtn').style.display = 'block';
		}   

		function addPositionField(containerId, fieldName) {
			const container = document.getElementById(containerId);
			const selectedOptions = Array.from(container.querySelectorAll('select')).map(select => select.value);
			const select = document.createElement("select");
			select.name = fieldName;

			const placeholderOption = document.createElement("option");
			placeholderOption.value = "";
			placeholderOption.text = "Choose a position...";
			placeholderOption.disabled = true;
			placeholderOption.selected = true;
			select.add(placeholderOption);

			positionsOptions.forEach(option => {
				if (!selectedOptions.includes(option)) {
					const opt = document.createElement("option");
					opt.value = option;
					opt.text = option;
					select.add(opt);
				}
			});

			container.appendChild(document.createElement("br"));
			container.appendChild(select);
		}
    </script>
</head>
<body>
    <h2>Отметьте отсутствующие позиции</h2>
    <form method="POST" action="/submit">
        
        <button type="button" onclick="window.location.href='/report'" class="button">Отчет</button>

        <button type="button" id="floorButton" class="button" onclick="document.getElementById('floorSelect').classList.toggle('hidden')">Этаж</button>
        <select id="floorSelect" name="floor" class="hidden" onchange="updateFloor(this)">
            <option value="">Выберите этаж</option>
            {% for floor in floors %}
                <option value="{{ floor }}">{{ floor }} этаж</option>
            {% endfor %}
        </select>

        <h3>Кладовка</h3>
        <div id="positions"></div>
        <button type="button" id="addPositionBtn" class="button hidden" onclick="addPositionField('positions', 'position_pantry')">Добавить позицию</button>
        
        <h3>Сервисная зона</h3>
        <div id="serviceZonePositions"></div>
        <button type="button" id="addServiceZonePositionBtn" class="button hidden" onclick="addPositionField('serviceZonePositions', 'position_service')">Добавить позицию</button>
        
        <input type="submit" id="submitBtn" value="Сохранить" style="display:none;">
    </form>
</body>
</html>